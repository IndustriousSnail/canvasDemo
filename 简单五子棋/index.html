<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <canvas id="canvas" style="border: 1px black solid;"></canvas>
</body>
</html>
<script>


    function random() {
        const num = Math.random() * 6;
        if (num > 4) {
            return 1;
        } else if (num > 2) {
            return 2;
        } else {
            return 0;
        }
    }

    const chessLayout = [];  // 15*15二维数组，0：无子，1：黑子，-1：白子

    /**
     * 初始化棋盘
     */
    for (let i = 0; i < 15; i++) {
        chessLayout.push([]);
        for (let j = 0; j < 15; j++) {
            chessLayout[i].push(random());
        }
    }

    console.log(chessLayout);

    /**
     * 检测胜负
     */
    function checkOutcome() {
        for (let i = 0; i < 15; i++) {
            for (let j = 0; j < 15; j++) {
                if (chessLayout[i][j] === 0) {
                    // 该位置无子
                    continue;
                }
                const color = chessLayout[i][j];
                {
                    let count = 0;
                    // 检测横向是否连成五子
                    for (let i2 = i + 1; i2 < i + 5 && i2 < 15; i2++) {
                        if (chessLayout[i2][j] == color) {
                            count++;
                        }
                    }
                    if (count >= 4) {
                        console.log('S', i, j);
                        return color;
                    }
                }
                {
                    let count = 0;
                    // 检测纵向是否连成五子
                    for (let j2 = j + 1; j2 < j + 5 && j2 < 15; j2++) {
                        if (chessLayout[i][j2] == color) {
                            count++;
                        }
                    }
                    if (count >= 4) {
                        console.log('E', i, j);
                        return color;
                    }
                }
                {
                    let count = 0;
                    // 检测ES方向是否连成五子
                    for (let i2 = i + 1, j2 = j + 1; i2 < i + 5 && i2 < 15 && j2 < j + 5 && j2 < 15; j2++, i2++) {
                        if (chessLayout[i2][j2] == color) {
                            count++;
                        }
                    }
                    if (count >= 4) {
                        console.log('ES', i, j);
                        return color;
                    }
                }
                {
                    let count = 0;
                    // 检测WS方向是否连成五子
                    for (let i2 = i + 1, j2 = j - 1; i2 < i + 5 && i2 < 0 && j2 > j - 5 && j2 >= 0; j2--, i2++) {
                        if (chessLayout[i2][j2] == color) {
                            count++;
                        }
                    }
                    if (count >= 4) {
                        console.log('WS', i, j);
                        return color;
                    }
                }

            }
        }
        return 0;
    }

    const result = checkOutcome();

    if (result === 1) {
        console.log('黑棋胜');
    } else if (result === 2) {
        console.log('白棋胜');
    } else {
        console.log('平局');
    }



    window.onload = function () {
        const WIDTH = 768;
        const HEIGHT = 1024;

        const canvas = document.getElementById('canvas');
        canvas.width = WIDTH;
        canvas.height = HEIGHT;
        const context = canvas.getContext('2d');
        if (!context) {
            alert('当前浏览器不支持canvas');
            return;
        }

        /**
         * 绘制棋盘
         */
        function drawChessboard() {
            context.beginPath();
            const xOffset = 50;
            const yOffset = 200;
            const intervalWidth = 45;
            context.moveTo(xOffset, yOffset);

            for (let i=0;i<15;i++){
                context.moveTo(xOffset+i*intervalWidth, yOffset);
                context.lineTo(xOffset+i*intervalWidth, yOffset+14*intervalWidth);
            }

            for (let i=0;i<15;i++){
                context.moveTo(xOffset, yOffset+i*intervalWidth);
                context.lineTo(xOffset+14*intervalWidth, yOffset+i*intervalWidth);
            }

            context.stroke();
        }

        drawChessboard();

        /**
         * 绘制棋子
         * @param x x坐标
         * @param y y坐标
         * @param isBlack 是否是黑子
         */
        function drawPiece(x,y,isBlack) {
            const pieceR = 17;
            context.beginPath();
            context.arc(x,y,pieceR,0,2*Math.PI);
            if (isBlack){
                context.fillStyle = 'black'
            } else {
                context.fillStyle = '#aaa'
            }
            context.strokeStyle = 'black'
            context.stroke();
            context.fill();
        }

        drawPiece(40,40,false);

    }
</script>